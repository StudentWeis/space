name: Package for distribution (Windows)
description: Creates distribution artifacts for Windows
inputs:
  target:
      description: The target of the binaries to package.
runs:
  using: composite
  steps:
    - name: Package release binaries
      shell: pwsh
      run: |
        .github/actions/package-windows/package-release-binaries.ps1 -Target ${{ inputs.target }}

    - name: Update Scoop manifest
      shell: pwsh
      run: |
        # The ARCHIVE_FILE_HASH env var is set by package-release-binaries.ps1 called above.
        # The CALCULATED_VERSION_KEY env var is set by the buildit coverage command.

        .github/actions/package-windows/update-scoop-manifest.ps1 `
          -Target ${{ inputs.target }} `
          -ArchiveFileHash $env:ARCHIVE_FILE_HASH `
          -Version $env:CALCULATED_VERSION_KEY
